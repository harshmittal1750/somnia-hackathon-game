<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>UI Test - Wallet Connection</title>
    <link rel="stylesheet" href="styles/main.css" />
    <style>
      body {
        padding: 20px;
        background: #1a1a1a;
      }
      .test-section {
        margin: 20px 0;
        padding: 20px;
        background: #333;
        border-radius: 10px;
      }
    </style>
  </head>
  <body>
    <h1>🧪 UI Test - Wallet Connection Buttons</h1>

    <div class="test-section">
      <h2>Current UI State</h2>
      <div id="status">Loading...</div>
    </div>

    <!-- Copy of the wallet panel from index.html -->
    <div id="web3Panel" class="panel">
      <div class="panel-content">
        <h1>🚀 Somnia Space Defender</h1>
        <p>Defend the galaxy against alien invasion!</p>

        <!-- Wallet Detection Status -->
        <div id="walletStatus" class="wallet-status">
          <p id="walletStatusText">Checking for wallet...</p>
        </div>

        <!-- Wallet Actions -->
        <div id="walletActions" class="wallet-actions">
          <button id="connectWallet" class="btn btn-primary hidden">
            🔗 Connect Wallet
          </button>

          <!-- Advanced Connection Options -->
          <div
            id="advancedConnectOptions"
            class="advanced-connect-options hidden"
          >
            <div class="connection-methods">
              <h4>🔗 Choose Connection Method</h4>
              <button id="connectMetaMask" class="btn btn-connector">
                🦊 MetaMask (Recommended)
              </button>
              <button id="connectWalletConnect" class="btn btn-connector">
                🔗 WalletConnect
              </button>
              <button id="connectCoinbase" class="btn btn-connector">
                🔵 Coinbase Wallet
              </button>
              <button id="connectInjected" class="btn btn-connector">
                💼 Other Injected Wallet
              </button>
            </div>
            <p class="connection-note">
              ℹ️ If one method fails, others will be tried automatically
            </p>
          </div>

          <button id="disconnectWallet" class="btn btn-secondary hidden">
            🔌 Disconnect
          </button>
          <button id="refreshConnection" class="btn btn-secondary hidden">
            🔄 Refresh Connection
          </button>
          <button id="downloadWallet" class="btn btn-primary hidden">
            📥 Get Wallet
          </button>
          <button id="showAdvancedConnect" class="btn btn-outline hidden">
            ⚙️ Advanced Connect
          </button>
        </div>

        <!-- Connected Wallet Info -->
        <div id="walletInfo" class="wallet-info hidden">
          <p>Connected: <span id="walletAddress"></span></p>
          <p>Network: <span id="networkName"></span></p>
        </div>
      </div>
    </div>

    <div class="test-section">
      <h2>Manual Controls</h2>
      <button onclick="testUI()">Test UI Update</button>
      <button onclick="forceShowButtons()">Force Show Advanced Buttons</button>
      <button onclick="checkManager()">Check Manager Status</button>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/web3@1.7.0/dist/web3.min.js"></script>

    <!-- Wagmi Core -->
    <script type="module">
      import { createClient } from "https://esm.sh/viem@2.x";
      import { createConfig } from "https://esm.sh/@wagmi/core@2.x";
      import {
        injected,
        metaMask,
        walletConnect,
        coinbaseWallet,
      } from "https://esm.sh/@wagmi/connectors@5.x";
      import { mainnet, sepolia } from "https://esm.sh/viem@2.x/chains";

      const somniaTestnet = {
        id: 50312,
        name: "Somnia Testnet",
        nativeCurrency: { decimals: 18, name: "STT", symbol: "STT" },
        rpcUrls: { default: { http: ["https://dream-rpc.somnia.network"] } },
        blockExplorers: {
          default: {
            name: "Shannon Explorer",
            url: "https://shannon-explorer.somnia.network",
          },
        },
        testnet: true,
      };

      const wagmiConfig = createConfig({
        chains: [somniaTestnet, mainnet, sepolia],
        connectors: [
          injected(),
          metaMask(),
          walletConnect({
            projectId: "27022fe9a4b6f8e10b631d90a341a3c0",
            metadata: {
              name: "Somnia Space Defender",
              description: "Web3 Space Defense Game",
              url: "https://spacedefender.xyz",
              icons: ["https://spacedefender.xyz/favicon.svg"],
            },
          }),
          coinbaseWallet({
            appName: "Somnia Space Defender",
            appLogoUrl: "https://spacedefender.xyz/favicon.svg",
          }),
        ],
      });

      window.wagmiConfig = wagmiConfig;
      window.somniaChain = somniaTestnet;
      console.log("🎯 Wagmi initialized");
    </script>

    <script src="js/config.js"></script>
    <script src="js/services/apiService.js"></script>
    <script src="js/wagmiManager.js"></script>
    <script src="js/hybridWeb3Manager.js"></script>

    <script>
      function updateStatus(message) {
        document.getElementById("status").innerHTML = message;
      }

      function testUI() {
        updateStatus("Testing UI...");
        if (typeof hybridWeb3Manager !== "undefined") {
          console.log("🔧 Forcing UI update...");
          hybridWeb3Manager.updateWalletUI();
          updateStatus("✅ UI updated - check wallet panel above");
        } else {
          updateStatus("❌ HybridWeb3Manager not found");
        }
      }

      function forceShowButtons() {
        updateStatus("Forcing buttons to show...");

        // Force show the advanced connect button
        const showAdvanced = document.getElementById("showAdvancedConnect");
        const connectWallet = document.getElementById("connectWallet");

        if (showAdvanced) showAdvanced.classList.remove("hidden");
        if (connectWallet) connectWallet.classList.remove("hidden");

        updateStatus("✅ Buttons forced to show");
      }

      function checkManager() {
        const info = {
          hybridManager: typeof hybridWeb3Manager,
          primaryAvailable: hybridWeb3Manager?.primaryProvider?.available,
          fallbackAvailable: hybridWeb3Manager?.fallbackProvider?.available,
          ethereum: typeof window.ethereum,
          wagmiConfig: typeof window.wagmiConfig,
        };

        updateStatus(`Manager Status: ${JSON.stringify(info, null, 2)}`);
        console.log("📊 Manager status:", info);
      }

      // Auto-run test after page loads
      setTimeout(() => {
        console.log("🚀 Auto-testing UI...");
        checkManager();
        setTimeout(testUI, 1000);
      }, 2000);

      // Add event listeners for the wallet buttons
      setTimeout(() => {
        document
          .getElementById("connectWallet")
          ?.addEventListener("click", () => {
            console.log("🔗 Connect wallet clicked");
            if (hybridWeb3Manager) {
              hybridWeb3Manager.connectWallet();
            }
          });

        document
          .getElementById("showAdvancedConnect")
          ?.addEventListener("click", () => {
            console.log("⚙️ Show advanced connect clicked");
            const advancedOptions = document.getElementById(
              "advancedConnectOptions"
            );
            if (advancedOptions) {
              advancedOptions.classList.remove("hidden");
            }
          });

        document
          .getElementById("connectMetaMask")
          ?.addEventListener("click", () => {
            console.log("🦊 MetaMask connect clicked");
            if (hybridWeb3Manager) {
              hybridWeb3Manager.connectMetaMask();
            }
          });

        document
          .getElementById("connectWalletConnect")
          ?.addEventListener("click", () => {
            console.log("🔗 WalletConnect clicked");
            if (hybridWeb3Manager) {
              hybridWeb3Manager.connectWagmi("walletconnect");
            }
          });

        updateStatus("✅ Event listeners attached");
      }, 3000);
    </script>
  </body>
</html>

